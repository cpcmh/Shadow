<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>🌳 그늘 경로 안내 (보행자 중심)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
<style>
html, body, #map { height: 100%; margin: 0; padding: 0; }
#panel { position: absolute; top: 10px; left: 10px; z-index: 9999; background: rgba(255,255,255,0.95); padding: 8px 12px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.25); font-size: 14px;}
#timeControl { position: absolute; top: 10px; right: 10px; z-index: 9999; background: rgba(255,255,255,0.95); padding: 6px 10px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.25); font-size: 14px;}
#locBtn { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; padding: 10px 20px; background: #1a73e8; color: #fff; border: none; border-radius: 25px; font-size: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);}
.blur-shadow { filter: blur(3px); opacity: 0.45; }
</style>
</head>
<body>
<div id="map"></div>
<div id="panel">📡 위치를 가져오려면 아래 버튼을 누르세요</div>
<div id="timeControl">
  <label for="timeInput">시간:</label>
  <input type="time" id="timeInput" step="900">
</div>
<button id="locBtn">📍 내 위치 가져오기</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
<script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<script>
const map = L.map('map');
const panel = document.getElementById('panel');
const shadowLayer = L.layerGroup().addTo(map);
const footwayLayer = L.layerGroup().addTo(map);
const routeLayer = L.layerGroup().addTo(map);

const defaultLocation = [37.5665, 126.9780];
let myLocation = null;
let destination = null;
let selectedTime = new Date();

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

map.setView(defaultLocation, 16);

// ☀️ 태양각도 계산
function getSunAngles(date, lat, lon){
  const pos = SunCalc.getPosition(date, lat, lon);
  return { azimuth: (180+pos.azimuth*180/Math.PI)%360, altitude: pos.altitude*180/Math.PI };
}

// ☁️ 그림자 생성
function computeShadow(buildings, trees, az, alt){
  if(alt <= 0) return [];
  const tanAlt = Math.tan(alt*Math.PI/180);
  const sunDir = (az+180)%360;
  const shadows = [];
  buildings.forEac
